# 实验报告 

计81 卢星宇 2018011280

## 任务概述

1.改进语法，添加类型，引入左值，支持取址和解引用以及类型转换。

2.加入类型检查步骤。

3.类型检查实现左值检查，类型检查。

4.实现对指针，取址和解引用的支持。

## 遇到的困难

这次任务的代码量非常大，新增了TypeChecker类进行类型检查，码量与之前实现的NameManager相差无几。具体细节参照参考代码完成。

类型检查器同样采用了Visitor设计模式，但逻辑相比NameManager和irgen要简单一些，遍历CST后，依据类型的运算规则，生成并存储所有有类型节点的类型即可。

这一步最大的问题是在左值分析时，如果简单地调用visitChildren函数，可能会加载变量的节点，但左值分析不需要加载节点，而是需要节点的地址，这一点通过重写一些visit函数来改正。

## 思考题

### 第一题

答：编译器在进行类型检查时，需要局部变量，全局变量和函数参数的信息，否则无法将标识符与之对应起来，变量类型检查就无从谈起，所以类型检查需要放到名称解析生成信息之后。

### 第二题

答：在C语言中，内存中的值可以被以多种类型方式读出，如97，以char读出即为字符a，以int读出即为97。

在C++中，某一类继承了一个或多个父类，该类的对象既为父类的类型又为子类的类型。

### 第三题

答：C语言要求比较双方为同一类型的指针，否则需进行显式或隐式的类型转换。指针比较的方法是将地址作为无符号整数畸形比较，原来的int比较是有符号类型，方法不一样。

### 代码参考

1.示例代码中的类型检查器

2.关于类型的定义方法。

