# 实验报告

计81 卢星宇 2018011280

## 任务概述

1.改进语法

2.名称解析器实现对数组size的计算

3.类型检查增加指针和整数的运算

4.Locator实现对数组索引的计算

5.irgen增加对指针和整数运算的判断

6.改进之前的语法检查方法

## 遇到的困难

最大的困难是之前全局变量的实现中，变量的size固定为4，加入数组全局变量之后忘记更改，导致很多测例过不了。

以及指针和整数的运算需要特判，否则会导致偏移量的错误。

## 思考题

### 第一题

A:\*(int\*)(4096 + 23 * 4)

B:\*(int\*)(4096 + 23 * 4)

C:\*(int\*)(4096 + 2 *10 \* 4 + 3 * 4)

D:\*(int*)(\*(int\*\*)(4096 + 2 \* 4) + 3 * 4)

E:\*(int*)(\*(int\*\*)(4096 + 2 \* 4) + 3 * 4)

### 第二题

答：即栈帧的位置直到运行时才能最终确认。

可以在编译时先为确定长度的变量开辟空间，然后假设所有的可变长数组size为0，将其头指针记为fp所在位置，待运行时确定了size之后，将size作为变量存储起来，再对fp和头指针位置进行减法操作，进行回收时再根据size进行加法操作。如果有多个可变长数组，需要依次为其开辟空间。